# 커널 스택

커널에서 허락된 스택 메모리가 정말 작아서 유저 레벨에서 사용하듯이 메모리를 잡아서 사용하면 안되는데...  
저번에 드라이버가 스택을 과도하게 사용하여 스택오버플로우가 발생했었던걸 확인했었는데  
이번 기회에 커널 스택에 대해서 좀 아는대로 정리를 해볼까 합니다.  

먼저 스레드에 대한 부분도 빠질수가 없을거 같은데..  
스레드는 경량화 프로세스로 이 스레드가 실행 될 때 함수의 인자, 지역 변수, 리턴 주소가 저장된 임시 기억 장소를  
참조해야 하는데 이런 정보들이 담기는 메모리를 스택이라고 합니다.  
그래서 메모리 관리자는 유저 스택과 커널 스택을 제공합니다.  

유저 스택 크기는 보통 1MB인데 커널 스택은 x86의 경우 12K 이며 x64의 경우는 16K입니다.  
유저 레벨에서 허락된 메모리에 비해서 훨씬 초라하게 느껴지는 메모리 가용량이죠..  
그리고 커널 스택은 뒤에 가드 PTE가 따라 옵니다.  
그래서 왠만하면 동적으로 할당해서 사용함으로써 스택 버퍼 크기를 작은 상태로 유지를 하는게 좋다고 생각합니다.  
그리고 커널 스택은 모든 프로세스에 의해 공유되는 시스템 주소 공간에 있습니다.(뭐 그래서 시스템에 영향을 준다고 하는데...)  

 


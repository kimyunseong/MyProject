# 시스템 메모리 풀 (Nonpaged Pool / Paged Pool)

시스템 초기화 시점에 메모리 매니져는 대부분의 커널 모드 컴포넌트들이 시스템 메모리 할당을 위해   
사용하는 동적인 크기를 갖는 두 개의 메모리 풀이나 힙을 생성합니다.  
두 메모리 풀 모두 시스템 영역의 주소 공간에 위치하며 모든 프로세스의 가상 주소에 매핑돼 있습니다.  
시스템은 4개의 페이지드 풀과 1개의 넌페이지드 풀을 갖고 실행되며,   
시스템의 NUMA 노드 개수에 따라 최대 64개까지 추가로 생성할 수 있습니다.  

## 넌페이지드 풀(Nonpaged Pool)  
물리 메모리 내에 있도록 보장되는 시스템 가상 주소 영역으로, 어느 프로세스 컨텍스트에서나   
페이지 폴트(Page Fault) 없이 어떤 IRQL에서도 언제든 접근이 가능합니다.  
넌페이지드 풀이 필요한 하나의 이유는 DPC/DISPATCH 레벨이나 그 이상의 IRQL에서는 페이지 폴트를 처리할 수 없기 때문입니다.  
따라서 DPC/DISPATCH 이상의 레벨에서 접근되는 데이터나 수행되는 코드는 반드시 페이지되지 않는 메모리 내에 있어야 합니다.  
일반적으로 넌페이지드 풀을 사용하는 경우는 프로세스 및 스레드를 나타내는 커널 및 개체, 이벤트와 같은 동기화 개체,  
파일 개체로 표시되는 파일 참조, IRP, 뮤텍스 같은 일반적인 시스템 데이터 구조를 저장할 때 사용 됩니다.  


## 페이지드 풀(Paged Pool)
물리 메모리에서 페이지 아웃(Paged-Out)되거나 페이지 인(Paged-In) 될 수 있는 시스템 가상 주소 영역으로 DPC/DISPATCH 레벨이나   
더 상위의 IRQL에서 해당 메모리에 접근할 필요가 없는 디바이스 드라이버들이 이것을 사용할 수 있습니다.  
그리고 어떤 프로세스 컨텍스트에서든 접근이 가능합니다.  
일반적으로 페이지드 풀을 사용하는 경우는 메모리 매핑 된 파일을 나타내는 데이터 구조를 저장할 때 사용 됩니다.  


|  <center>풀 종류</center> |  <center>32bit</center> |  <center>Win7 64bit</center> | <center>Win8 64bit</center> |
|:--------:|:--------:|:--------:|:--------:|
|**<center>넌페이지드</center>** | <center>물리 메모리의 75%나 2GB중 작은 값</center> |*<center>물리 메모리의 75%나 128GB 중 작은 값 </center>* |*<center>15.5TB</center>* |
|**<center>페이지드</center>** | <center>2GB</center> |*<center>128GB</center>* |*<center>384GB</center>* |


참고 문헌 : Windows Internals